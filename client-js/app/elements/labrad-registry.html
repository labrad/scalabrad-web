<link rel="import" href="../bower_components/paper-input/paper-textarea.html">
<link rel="import" href="app-link.html">
<link rel="import" href="dir-item.html">

<!-- This is the component that simply renders the table of registry content -->
<dom-module id="labrad-registry">
  <style>
    :host {
      display: block;
    }

    #reg-menu {
      position: fixed;
      top: 140px;
      left: 33px;
      @apply(--shadow-elevation-2dp);
      padding-top: 5px;
      padding-bottom: 5px;
      background-color: white;
    }

    #reg-area {
      margin-top: 85px;
      padding-top: 12px;
      background-color: white;
      display: inline-block;
      @apply(--shadow-elevation-2dp);
      height: 100%;
    }

    .iron-selected {
      background-color: #ddd;
    }
    .iron-selector {
      width: 100%;
      display: block;
      border: 1px solid #ccc;
      border-top: none;
    }
    
    table {
      width: 100%;
    }
    tbody {
      display:table-header-group;
    }

    .table-header {
      @apply(--paper-font-body1);
      color: var(--secondary-text-color);
      *text-align: middle;
      border-bottom: 1px solid;
      border-bottom-color: #e5e5e5;
      display:table-header-group;

    }
    .label-wide {
      width: 100%;
    }

    paper-dialog.size-position {
      position: fixed;
      top: 16p
      right: 16px;
    }
    paper-dialog.size-position {
      width: 300px;
      height: 300px;
    }
    menu-button {
      color: #0F9D58;
    }
    iron-autogrow-textarea {
      max-width: 400px;
    }
    #search-bar {
      padding: 0px 10px;
    }
    #search-bar input {
      font-family: var(--primary-font-family);
      font-size: 15px;
      width: 50%;
      padding: 10px;
      border: 0;
      border-radius: 2px;
      -webkit-appearance: none;
    }
  </style>
  <template>
    <div id="reg-area">
      <div id="search-bar">
        <iron-icon icon="search"></iron-icon>
        <input type="search" id="search" value="{{filterText::input}}" placeholder="search registry">
      </div> 
      <table>
        <tbody is="selectable-table" attr-for-selected="name" selected="{{selDir}}" on-tap="selectDir">
          <template id="dirList" is="dom-repeat" items="{{dirs}}" filter="filterFunc">
            <tr name="{{item.name}}">
              <td>
                <a is="app-link" path="{{item.url}}" href="{{item.url}}">
                  <dir-item kind="folder">{{item.name}}</dir-item>
                </a>
              </td>
              <td class="label-wide"></td>
            </tr>
          </template>
        </tbody>
        <tbody is="selectable-table" attr-for-selected="name"  selected="{{selKey}}" on-tap="selectKey">
          <template id="keyList" is="dom-repeat" items="{{keys}}" filter="filterFunc">
            <tr name="{{item.name}}">
              <td>
                <dir-item kind="key">{{item.name}}</dir-item>
              </td>
              <td class="label-wide">
                <form is="iron-form" id="{{item.name}}">
                  <iron-a11y-keys keys="tab" on-keys-pressed="incrementSelector">
                      <expandable-input name="{{item.name}}" value="{{item.value}}"></expandable-input>
                  </iron-a11y-keys>
                </form>
              </td>
            </tr>
          </template>
        </tbody>
      </table>
    </div>
    <div id="reg-menu">
      <section>
        <menu-button on-click="newKeyClicked" name="new key" icon-name="create"></menu-button>
        <menu-button on-click="newFolderClicked" name="new folder" icon-name="folder-open"></menu-button>
        <menu-button on-click="copyClicked" name="copy" icon-name="content-copy" disabled={{!selected}}></menu-button>
        <menu-button on-click="renameClicked" name="rename" icon-name="code" disabled={{!selected}}></menu-button>
        <menu-button on-click="deleteClicked" name="delete" icon-name="delete" disabled={{!selected}}></menu-button>
      </section>
    </div>
    <!-- Dialogs for various registry operations -->

    <paper-dialog id="newKeyDialog" modal>
      <h1>Create new key</h1>

      <form>
        <paper-input id="newKeyInput" label="Key"></paper-input>
        <paper-textarea id="newValueInput" label="Value"></paper-textarea>
      </form>
      <div class="buttons"> 
        <paper-button on-click="doNewKey" dialog-confirm>OK</paper-button>
        <paper-button dialog-dismiss>CANCEL</paper-button>
      </div>
    </paper-dialog>

    <paper-dialog id="newFolderDialog" modal>
      <h1>Create new folder</h1>
      <form>
        <paper-input id="newFolderInput" label="Name"></paper-input>
      </form>
      <div class="buttons">
        <paper-button on-click="doNewFolder" dialog-confirm autofocus>OK</paper-button>
        <paper-button dialog-dismiss>CANCEL</paper-button>
      </div>
    </paper-dialog>

    <paper-dialog id="copyDialog" modal>
      <h1>Copy <span>{{selectType}}</span> "<span>{{selDir}}</span><span>{{selKey}}</span>"</h1>
      <form>
        <paper-input id="copyNameInput" label="New Name" always-float-label></paper-input>
        <paper-input id="copyPathInput" label="New Path" always-float-label></paper-input>
      </form>
      <div class="buttons">
        <paper-button on-click="doCopy" dialog-confirm>OK</paper-button>
        <paper-button dialog-dismiss>CANCEL</paper-button>
      </div>
    </paper-dialog>

    <paper-dialog id="renameDialog" modal>
      <h1>Rename <span>{{selectType}}</span> "<span>{{selDir}}</span><span>{{selKey}}</span>"</h1>
      <form>
        <paper-input id="renameInput" label="New Name" always-float-label></paper-input>
      </form>
      <div class="buttons">
        <paper-button on-click="doRename" dialog-confirm autofocus>OK</paper-button>
        <paper-button dialog-dismiss>CANCEL</paper-button>
      </div>
    </paper-dialog>

    <paper-dialog id="deleteDialog" modal>
      <h1>Delete <span>{{selectType}}</span> "<span>{{selDir}}</span><span>{{selKey}}</span>"?</h1>
      <div class="buttons">
        <paper-button on-click="doDelete" dialog-confirm autofocus>OK</paper-button>
        <paper-button dialog-dismiss>CANCEL</paper-button>
      </div>
    </paper-dialog>
  </template>
</dom-module>
